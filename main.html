<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Prayer Times App</title>
	<style>
		body {
			margin: 0;
			font-family: 'Segoe UI', sans-serif;
			background: #062c25;
			color: white;
			padding: 20px;
		}

		.container {
			max-width: 420px;
			margin: auto;
		}

		.date-box {
			display: flex;
			justify-content: center;
			/* horizontal center */
			align-items: center;
			/* vertical center */
			text-align: center;
			position: relative;
			background-color: brown;
			border-radius: 10px;
			box-shadow: 0px 0px 22px 0px black;
		}

		.location {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin: 10px 0;
			font-size: 14px;
		}

		h3 {
			margin: 20px;
		}

		.card {
			background: #0b3c33;
			padding: 20px;
			border-radius: 16px;
			margin-top: 10px;
			height: 100px;
			display: flex;
			justify-content: space-between;
			gap: 20px;
			flex-wrap: wrap;
			margin-bottom: 10px;

			/* makes it responsive */
		}

		.card-section {
			/*			flex: 1 1 100px;*/
			/* grow/shrink with min width of 200px */
			color: yellow;
			font-weight:
		}

		.card h2 {
			margin: 0;
			font-size: 32px;
		}

		.prayer-list {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
		}

		.prayer-item {
			background: #0e463a;
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 12px 16px;
			border-radius: 12px;
			width: calc(50% - 10px);
			/* two per row with gap */
			box-sizing: border-box;
			box-shadow: 0px 0px 22px 0px black;
			border-radius: 10px;
		}


		.now-tag {
			background: #ffaa00;
			padding: 2px 8px;
			border-radius: 8px;
			color: black;
			font-size: 12px;
			margin-left: 10px;
		}

		.progress-section {
			margin-top: 30px;
		}

		.tabs {
			display: flex;
			justify-content: center;
			gap: 10px;
			margin-bottom: 10px;
		}

		.tabs button {
			background: #083e34;
			color: white;
			border: none;
			padding: 8px 16px;
			border-radius: 20px;
			cursor: pointer;
		}

		.tabs .active {
			background: white;
			color: #083e34;
		}

		.calendar {
			display: flex;
			flex-wrap: wrap;
			justify-content: flex-start;

		}

		.calendar-day {
			width: 10.28%;
			text-align: left;
			/* Center inline content (text, inline-block) */
			font-size: 12px;
			margin: 4px;
			cursor: pointer;
			display: flex;
			justify-content: center;
			/* Center content horizontally */
			align-items: center;
			box-shadow: 0px 0px 5px 0px black;
			border-radius: 10px;
			/* Center content vertically */
		}

		.calendar-day.active {
			background: white;
			color: black;
			padding: 1px;
			border-radius: 10px;

		}

		#digital-clock {
			font-size: 50px;
			/* responsive font size */
			text-align: right;
			font-weight: bolder;
			color: red;
			position: relative;
			top: -20px;
			color: lightgoldenrodyellow;
			/* also responsive */
			margin: 0;
			text-shadow: 0 0 0px white, 0 0 10px black, 0 0 10px #00ff99;



		}

		/*
		@media (max-width: 1080px) {
			#digital-clock {
				font-size: 9vw;
				top: 0;
			}
		}
*/

	</style>
</head>

<body>
	<div class="container">
		<div class="date-box">
			<h3 id="gregorian-date" style="float: left;">Today</h3> |
			<h3 id="hijri-date" style="float: right;">Hijri Date</h3>
		</div>
		<div class="location"> <span id="location">üìç Getting location...</span> <span>‚úîÔ∏è Islamic Centre</span> </div>
		<div class="card">
			<div class="card-section" style="text-align: left;"> <strong>Now</strong>
				<h2 id="current-prayer">--</h2>
			</div>
			<div class="card-section">
				<p id="digital-clock"></p>

			</div>


		</div>
		<div class="prayer-list" id="prayer-list"></div>
		<div class="progress-section">
			<div class="tabs">
				<button class="active" onclick="showWeek()">Week</button>
				<button onclick="showMonth()">Month</button>
			</div>
			<div class="cal_main">
				<div class="calendar" id="calendar"></div>
			</div>
		</div>
	</div>
	<div id="weather"> test
		<span id="weather-temp"></span> |
		<span id="weather-wind"></span>
	</div>
	<script>
		function updateDigitalClock() {
			const now = new Date();
			let hours = now.getHours();
			const minutes = now.getMinutes();
			const seconds = now.getSeconds();
			const ampm = hours >= 12 ? "PM" : "AM";
			hours = hours % 12 || 12;

			const timeStr = `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
			document.getElementById("digital-clock").innerHTML = timeStr + "<br>" + ampm;

		}

		// Update clock every second
		setInterval(updateDigitalClock, 1000);
		// Initialize immediately
		updateDigitalClock();

		function formatTime12h(timeStr) {
			// Accepts "HH:MM" or "HH:MM:SS"
			let parts = timeStr.split(":");
			let hour = Number(parts[0]);
			let minute = Number(parts[1]);
			let second = parts.length > 2 ? Number(parts[2]) : 0;

			const ampm = hour >= 12 ? "PM" : "AM";
			hour = hour % 12 || 12;

			return `${hour}:${minute.toString().padStart(2, "0")} ${ampm}`;
		}

		async function fetchPrayerTimes(selectedDate = new Date()) {
			if (!userCoords) return;
			const lat = userCoords.latitude;
			const lon = userCoords.longitude;
			const method = 2;
			const day = selectedDate.getDate();
			const month = selectedDate.getMonth() + 1;
			const year = selectedDate.getFullYear();

			const url = `https://api.aladhan.com/v1/calendar?latitude=${lat}&longitude=${lon}&method=${method}&month=${month}&year=${year}&school=1`;



			try {
				const res = await fetch(url);
				const data = await res.json();
				const today = data.data[day - 1];
				const timings = today.timings;
				const hijriDate = today.date.hijri;
				const readableDate = today.date.readable;

				document.getElementById('gregorian-date').textContent = `Today, ${readableDate}`;
				document.getElementById('hijri-date').textContent = `${hijriDate.day} ${hijriDate.month.en} ${hijriDate.year}`;

				const prayerOrder = [{
						name: "Imsak üåô",
						key: "Imsak"
					},
					{
						name: "Fajr ‚ú®",
						key: "Fajr"
					},
					{
						name: "Sunrise üåÖ",
						key: "Sunrise"
					},
					{
						name: "Ishraq üåÑ",
						key: "Ishraq",
						derived: true
					},

					{
						name: "Dhuhr ‚òÄÔ∏è",
						key: "Dhuhr"
					},
					{
						name: "Asr ‚òÅÔ∏è",
						key: "Asr"
					},
					{
						name: "Maghrib üåá",
						key: "Maghrib"
					},
					{
						name: "Isha‚Äôa üåô",
						key: "Isha"
					}
				];



				const prayerList = document.getElementById("prayer-list");
				prayerList.innerHTML = "";
				const now = new Date();
				const nowTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), now.getHours(), now.getMinutes(), now.getSeconds());

				let nextPrayer = null;
				let currentPrayer = null;

				const getTimeObj = (timeStr) => {
					let [h, m, s = "0"] = timeStr.split(":");
					const t = new Date(selectedDate);
					t.setHours(Number(h), Number(m), Number(s));
					return t;
				};

				for (let i = 0; i < prayerOrder.length; i++) {
					const prayer = prayerOrder[i];
					let timeStr24;

					// Derive Ishraq from Sunrise + 15 minutes
					if (prayer.derived && prayer.key === "Ishraq") {
						const sunriseTimeStr = timings["Sunrise"].split(" ")[0];
						let [h, m] = sunriseTimeStr.split(":").map(Number);
						m += 22;
						if (m >= 60) {
							h += 1;
							m -= 60;
						}
						timeStr24 = `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}:00`;
					} else {
						timeStr24 = timings[prayer.key].split(" ")[0];
						if (timeStr24.length === 5) timeStr24 += ":00";
					}

					const prayerTime = getTimeObj(timeStr24);

					if (nowTime < prayerTime && !nextPrayer) {
						nextPrayer = {
							...prayer,
							timeStr24,
							time: prayerTime
						};
					}
					if (nowTime >= prayerTime) {
						currentPrayer = {
							...prayer,
							timeStr24,
							time: prayerTime
						};
					}

					const isNow = currentPrayer?.key === prayer.key && (!nextPrayer || nowTime < nextPrayer.time);
					const item = document.createElement("div");
					item.className = "prayer-item";
					item.innerHTML = `<span>${prayer.name}</span><span>${formatTime12h(timeStr24)}</span>`;
					prayerList.appendChild(item);
				}


				document.getElementById("current-prayer").innerHTML = `<span>${currentPrayer?.name || "--"}</span><br> <span>${currentPrayer ? formatTime12h(currentPrayer.timeStr24) : ""}</span>`;

			} catch (e) {
				console.error("Prayer fetch error", e);
			}
		}


		function showWeek() {
			switchTab("Week");
			const calendar = document.getElementById("calendar");
			calendar.innerHTML = "";
			const now = new Date();
			const start = new Date(now);
			start.setDate(now.getDate() - now.getDay());
			for (let i = 0; i < 7; i++) {
				const date = new Date(start);
				date.setDate(start.getDate() + i);
				const isToday = date.toDateString() === now.toDateString();
				const el = document.createElement("div");
				el.className = `calendar-day ${isToday ? 'active' : ''}`;
				el.innerHTML = `${date.toLocaleDateString('en-US', { weekday: 'short' })}<br>${date.getDate()}`;
				el.addEventListener("click", () => {
					fetchPrayerTimes(date);
					highlightActiveDay(el);
				});
				calendar.appendChild(el);
			}
		}

		function highlightActiveDay(selectedEl) {
			const allDays = document.querySelectorAll(".calendar-day");
			allDays.forEach(el => el.classList.remove("active"));
			selectedEl.classList.add("active");
		}


		function showMonth() {
			switchTab("Month");
			const calendar = document.getElementById("calendar");
			calendar.innerHTML = "";
			const now = new Date();
			const year = now.getFullYear();
			const month = now.getMonth();
			const daysInMonth = new Date(year, month + 1, 0).getDate();
			const firstDay = new Date(year, month, 1).getDay();
			for (let i = 0; i < firstDay; i++) {
				const empty = document.createElement("div");
				empty.className = "calendar-day";
				empty.innerHTML = "&nbsp;";
				calendar.appendChild(empty);
			}
			for (let d = 1; d <= daysInMonth; d++) {
				const date = new Date(year, month, d);
				const isToday = d === now.getDate();
				const el = document.createElement("div");
				el.className = `calendar-day ${isToday ? 'active' : ''}`;
				el.innerHTML = `${date.toLocaleDateString('en-US', { weekday: 'short' })}<br>${d}`;
				el.addEventListener("click", () => {
					fetchPrayerTimes(date);
					highlightActiveDay(el);
				});
				calendar.appendChild(el);
			}
		}

		function switchTab(tab) {
			const buttons = document.querySelectorAll(".tabs button");
			buttons.forEach(btn => {
				btn.classList.remove("active");
				if (btn.textContent === tab) btn.classList.add("active");
			});
		}
		// Initial load
		navigator.geolocation.getCurrentPosition(async (pos) => {
			userCoords = pos.coords;
			try {
				const locRes = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${userCoords.latitude}&lon=${userCoords.longitude}`);
				const locData = await locRes.json();
				document.getElementById("location").textContent = `üìç ${locData.address.city || locData.address.town || locData.address.village || 'Your Location'}`;
			} catch (e) {
				document.getElementById("location").textContent = "üìç Location Unavailable";
			}
			fetchPrayerTimes();
		});
		showWeek();



		async function fetchWeather(lat, lon) {
			const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,wind_speed_10m`;

			try {
				const res = await fetch(url);
				const data = await res.json();

				const temp = data.current.temperature_2m;
				const wind = data.current.wind_speed_10m;

				document.getElementById("weather-temp").textContent = `üå° ${temp}¬∞C`;
				document.getElementById("weather-wind").textContent = `üí® ${wind} km/h`;
			} catch (err) {
				console.error("Weather fetch error", err);
			}
		}

	</script>
</body>

</html>
